# AI Agent Context: DeepStream Drone Pipeline

## System Identity
*   **Domain:** Computer Vision, Embedded Systems, Real-time Telemetry.
*   **Core Framework:** NVIDIA DeepStream SDK (GStreamer-based).
*   **Hardware Target:** NVIDIA dGPU (Ampere/Ada Architecture).
*   **Operating Context:** Linux (Ubuntu 22.04) via WSL2 Virtualization.

## Architecture & Data Flow

### Pipeline Specifications
The GStreamer pipeline is strict and order-dependent. Modifications to the sequence will break memory negotiation.

1.  **Ingestion:** `udpsrc` (UDP/5000) -> `srtpdec` (Secure Decryption).
2.  **Parsing:** `rtph264depay` -> `h264parse`.
3.  **Decoding:** `nvv4l2decoder`.
    *   *Constraint:* Must output into NVMM (NVIDIA Memory Map) memory for zero-copy.
4.  **Muxing:** `nvstreammux`.
    *   *Constraint:* Acts as the batch aggregator. Resolution defined here scales all inputs.
5.  **Inference:** `nvinfer`.
    *   *Config:* Loaded from `config_infer_primary_yolo.txt`.
    *   *Backend:* TensorRT.
6.  **Visualization:** `nvvideoconvert` -> `nvdsosd` (On-Screen Display) -> `nveglglessink`.

### Critical Bindings (Python)
*   **`pyds`**: Proprietary NVIDIA bindings. Used for accessing metadata (bounding boxes, class IDs) in the `osd_sink_pad_buffer_probe`.
*   **`Gst`**: Standard GStreamer bindings for element management.

## Environment Constraints
*   **SRTP Keys:** Hardcoded RFC 3711 test vectors in `main.py` (`srtp_request_key_callback`). 
    *   *Note:* Real-world DJI implementations usually require a dynamic handshake or static key provisioning via config.
*   **Display Output:** WSLg requires `nveglglessink`. `noverlaysink` (Jetson standard) is NOT compatible here.
*   **TensorRT Engines:** The `.wts` or `.engine` files are assumed to be present or generated by the user. The app builds the *scaffolding* but does not download weights.

## Development Directives
*   **Performance:** Always prefer `nv` prefixed plugins (e.g., `nvvideoconvert` over `videoconvert`) to keep data in VRAM.
*   **Stability:** If `pyds` is missing, the application will crash during the probe phase. Dependency checks are implemented in `setup.sh`.
*   **Networking:** UDP packets from external sources must be NAT-forwarded to the WSL2 instance IP.